FROM alpine:latest

RUN apk --no-cache add ca-certificates shadow

ENV STATIC_PATH /app/data

#
RUN groupadd -r -g 600 webadmin \
  && groupadd -r -g 601 jboss \
  && useradd -r -u 601 -g 601 -s /sbin/nologin -c 'web user' jboss \
  && usermod -aG webadmin jboss

#
RUN mkdir -p $STATIC_PATH \
  && mkdir -p /web_static \
  && chown jboss:webadmin /web_static

COPY app $STATIC_PATH
COPY static_entry.sh /app

RUN find /app -exec chown jboss:webadmin -- '{}' + \
  && chmod u+x /app/static_entry.sh

#VOLUME /web_static

#RUN chown jboss:webadmin /web_static

USER jboss

ENTRYPOINT ["/app/static_entry.sh"]

