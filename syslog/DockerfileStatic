FROM alpine:latest

RUN apk --no-cache add ca-certificates shadow

#
ENV APP_DIR /app
ENV STATIC_DIR /web_static

#
RUN groupadd -r -g 600 webadmin \
  && groupadd -r -g 601 jboss \
  && useradd -r -u 601 -g 601 -s /sbin/nologin -c 'web user' jboss \
  && usermod -aG webadmin jboss

#
RUN mkdir -p $STATIC_DIR \
  && chown jboss:webadmin $STATIC_DIR \
  && mkdir -p $APP_DIR

#
COPY app $APP_DIR

RUN find /app -exec chown jboss:webadmin -- '{}' + \
  && chmod u+x /app/static_entry.sh

#
USER jboss

ENTRYPOINT ["/app/static_entry.sh"]

